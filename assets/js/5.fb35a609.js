(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{360:function(t,_,v){t.exports=v.p+"assets/img/https-1.f96a5906.png"},361:function(t,_,v){t.exports=v.p+"assets/img/https-2.48e2231a.png"},362:function(t,_,v){t.exports=v.p+"assets/img/https-3.7cdfe9de.png"},434:function(t,_,v){"use strict";v.r(_);var s=v(42),e=Object(s.a)({},(function(){var t=this,_=t.$createElement,s=t._self._c||_;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https"}},[t._v("#")]),t._v(" https")]),t._v(" "),s("blockquote",[s("p",[t._v("https不是一种新的协议,是在HTTP跟TCP中间加多了一层加密层TLS/SSL")])]),t._v(" "),s("p",[s("img",{attrs:{src:v(360),alt:"https-1"}})]),t._v(" "),s("h2",{attrs:{id:"https-和-http有什么区别？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https-和-http有什么区别？"}},[t._v("#")]),t._v(" https 和 http有什么区别？")]),t._v(" "),s("h3",{attrs:{id:"http"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http"}},[t._v("#")]),t._v(" http")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("80")]),t._v(" 端口")])]),t._v(" "),s("ul",[s("li",[t._v("通信使用"),s("code",[t._v("明文（不加密）")]),t._v("，内容可能会被"),s("code",[t._v("窃听")])]),t._v(" "),s("li",[t._v("不会验证通信方的身份，因此可能会遭遇"),s("code",[t._v("伪装")])]),t._v(" "),s("li",[t._v("无法保证"),s("code",[t._v("报文的完整性")]),t._v("，请求或响应的内容被"),s("code",[t._v("篡改")]),t._v("也无法知道")])]),t._v(" "),s("h3",{attrs:{id:"https-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https-2"}},[t._v("#")]),t._v(" https")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("443")]),t._v(" 端口")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("https == http + 加密 + 身份验证 + 数据完整性保护\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"https-流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https-流程"}},[t._v("#")]),t._v(" https 流程")]),t._v(" "),s("p",[s("img",{attrs:{src:v(361),alt:"https-2"}})]),t._v(" "),s("ul",[s("li",[t._v("1.客户端首次请求服务器，告诉服务器自己"),s("code",[t._v("支持的SSL/TLS协议版本")]),t._v("，"),s("code",[t._v("支持的加密算法")]),t._v("及"),s("code",[t._v("压缩算法")]),t._v("，并生成一个"),s("code",[t._v("随机数（R1）")]),t._v("告知服务器.")]),t._v(" "),s("li",[t._v("2.服务器确认双方使用的加密方法，并返回给"),s("code",[t._v("客户端证书")]),t._v("以及一个服务器生成的"),s("code",[t._v("随机数（R2）")])]),t._v(" "),s("li",[t._v("3.客户端收到证书后，首先验证证书的有效性，然后生成一个新的"),s("code",[t._v("随机数（premaster secret）")]),t._v("，并使用数字证书中的"),s("code",[t._v("公钥")]),t._v("，"),s("code",[t._v("加密")]),t._v("这个随机数，发送给服务器。")]),t._v(" "),s("li",[t._v("4.服务器接收到加密后的随机数后，使用"),s("code",[t._v("私钥")]),t._v("进行解密，获取这个"),s("code",[t._v("随机数（premaster secret）")])]),t._v(" "),s("li",[t._v("5.服务器和客户端根据约定的加密方法，使用前面的"),s("code",[t._v("三个随机数（R1, R2, premaster secret）")]),t._v("，生成"),s("code",[t._v("“对话密钥”（session key）")]),t._v("，用来加密接下来的整个对话过程。")])]),t._v(" "),s("h3",{attrs:{id:"_1-为什么握手过程需要三个随机数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么握手过程需要三个随机数"}},[t._v("#")]),t._v(" 1. 为什么握手过程需要三个随机数?")]),t._v(" "),s("p",[t._v("不管是客户端还是服务器，都需要随机数，这样生成的密钥才不会每次都一样。由于SSL协议中证书是静态的，因此十分有必要引入一种随机因素来保证协商出来的密钥的"),s("code",[t._v("随机性")]),t._v("。\n对于RSA密钥交换算法来说，pre-master-key本身就是一个随机数，再加上hello消息中的随机，三个随机数通过一个密钥导出器最终导出一个对称密钥。\npre master的存在在于SSL协议不信任每个主机都能产生完全随机的随机数，如果随机数不随机，那么pre master secret就有可能被猜出来，那么仅适用pre master secret作为密钥就不合适了，因此必须引入新的随机因素，那么客户端和服务器加上pre master secret三个随机数一同生成的密钥就不容易被猜出了，"),s("code",[t._v("一个伪随机可能完全不随机，可是是三个伪随机就十分接近随机了")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_2-fiddler-charles等可实现对https请求的拦截，怎么实现的？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-fiddler-charles等可实现对https请求的拦截，怎么实现的？"}},[t._v("#")]),t._v(" 2. fiddler/charles等可实现对https请求的拦截，怎么实现的？")]),t._v(" "),s("p",[t._v("fiddler/charles要实现对https的拦截，首先要做的就是，在客户端安装fiddler/charles自己导出的证书，并信任该证书。\n原理就是，fiddler/charles在客户端和服务器间充当了中间人的角色，在客户端面前假装是https服务器，在真正的https服务器前假装是客户端。")]),t._v(" "),s("p",[s("img",{attrs:{src:v(362),alt:"https-3"}})]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"https中间人攻击"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https中间人攻击"}},[t._v("#")]),t._v(" https中间人攻击")]),t._v(" "),s("blockquote",[s("p",[t._v("类似 fiddler/charles")])]),t._v(" "),s("ul",[s("li",[t._v("1.客户端请求被劫持，将所有的请求发送到中间人的服务器")]),t._v(" "),s("li",[t._v("2.中间人服务器返回自己的证书")]),t._v(" "),s("li",[t._v("3.客户端创建随机数，使用中间人证书中的公钥进行加密发送给中间人服务器，中间人使用私钥对随机数解密并构造对称加密，对之后传输的内容进行加密传输")]),t._v(" "),s("li",[t._v("4.中间人通过客户端的随机数对客户端的数据进行解密")]),t._v(" "),s("li",[t._v("5.中间人与服务端建立合法的https连接（https握手过程），与服务端之间使用对称加密进行数据传输，拿到服务端的响应数据，并通过与服务端建立的对称加密的秘钥进行解密。")]),t._v(" "),s("li",[t._v("6.中间人再通过与客户端建立的对称加密对响应数据进行加密后传输给客户端")]),t._v(" "),s("li",[t._v("7.客户端通过与中间人建立的对称加密的秘钥对数据进行解密")])]),t._v(" "),s("h3",{attrs:{id:"https-握手过程中，客户端如何验证证书的合法性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https-握手过程中，客户端如何验证证书的合法性"}},[t._v("#")]),t._v(" HTTPS 握手过程中，客户端如何验证证书的合法性")]),t._v(" "),s("p",[t._v("CA证书中会包含"),s("code",[t._v("颁发机构信息")]),t._v("、"),s("code",[t._v("公钥")]),t._v("、"),s("code",[t._v("公司信息")]),t._v("、"),s("code",[t._v("域名")]),t._v("、"),s("code",[t._v("有效期")]),t._v("等信息，浏览器验证证书：")]),t._v(" "),s("ul",[s("li",[t._v("首先就是要验证"),s("code",[t._v("域名、有效期")]),t._v("等信息是否正确")]),t._v(" "),s("li",[t._v("然后判断证书"),s("code",[t._v("来源的合法性")]),t._v("。每份签发证书都可以根据验证链查找到对应的根证书，操作系统、浏览器会在本地存储权威机构的根证书，利用本地根证书可以对对应机构签发证书完成来源验证")]),t._v(" "),s("li",[t._v("判断证书"),s("code",[t._v("是否被篡改")]),t._v("。需要与 CA 服务器进行校验")]),t._v(" "),s("li",[t._v("判断证书"),s("code",[t._v("是否已吊销")])])]),t._v(" "),s("p",[t._v("相关链接：")]),t._v(" "),s("ul",[s("li",[t._v("https://www.jianshu.com/p/7158568e4867")]),t._v(" "),s("li",[t._v("https://juejin.im/post/5e44e17a518825491b11bd63")]),t._v(" "),s("li",[t._v("https://coolcao.com/2018/08/06/https/")])])])}),[],!1,null,null,null);_.default=e.exports}}]);