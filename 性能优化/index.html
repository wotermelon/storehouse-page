<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>性能优化 | store house</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="Just store something">
    <link rel="preload" href="/storehouse-page/assets/css/0.styles.50cbef9e.css" as="style"><link rel="preload" href="/storehouse-page/assets/js/app.89c6b4d2.js" as="script"><link rel="preload" href="/storehouse-page/assets/js/2.36872be9.js" as="script"><link rel="preload" href="/storehouse-page/assets/js/9.6aff79fc.js" as="script"><link rel="prefetch" href="/storehouse-page/assets/js/10.4cd06e5c.js"><link rel="prefetch" href="/storehouse-page/assets/js/11.25745276.js"><link rel="prefetch" href="/storehouse-page/assets/js/12.8c0c94f2.js"><link rel="prefetch" href="/storehouse-page/assets/js/13.b8739b34.js"><link rel="prefetch" href="/storehouse-page/assets/js/14.9b2a31ca.js"><link rel="prefetch" href="/storehouse-page/assets/js/15.eadaf429.js"><link rel="prefetch" href="/storehouse-page/assets/js/16.4f0d9ddb.js"><link rel="prefetch" href="/storehouse-page/assets/js/17.33f5c585.js"><link rel="prefetch" href="/storehouse-page/assets/js/18.3a7d28ba.js"><link rel="prefetch" href="/storehouse-page/assets/js/19.00200056.js"><link rel="prefetch" href="/storehouse-page/assets/js/20.ec841d58.js"><link rel="prefetch" href="/storehouse-page/assets/js/21.37b51240.js"><link rel="prefetch" href="/storehouse-page/assets/js/22.7398da92.js"><link rel="prefetch" href="/storehouse-page/assets/js/23.efca3ac6.js"><link rel="prefetch" href="/storehouse-page/assets/js/24.07f06442.js"><link rel="prefetch" href="/storehouse-page/assets/js/25.f4dc33ea.js"><link rel="prefetch" href="/storehouse-page/assets/js/26.3db162a8.js"><link rel="prefetch" href="/storehouse-page/assets/js/27.96afb93e.js"><link rel="prefetch" href="/storehouse-page/assets/js/28.4adec476.js"><link rel="prefetch" href="/storehouse-page/assets/js/29.4adaadf3.js"><link rel="prefetch" href="/storehouse-page/assets/js/3.69e99c43.js"><link rel="prefetch" href="/storehouse-page/assets/js/30.6559a30b.js"><link rel="prefetch" href="/storehouse-page/assets/js/31.74e6d4b3.js"><link rel="prefetch" href="/storehouse-page/assets/js/32.e2475ea0.js"><link rel="prefetch" href="/storehouse-page/assets/js/33.501c4d1e.js"><link rel="prefetch" href="/storehouse-page/assets/js/34.15bad241.js"><link rel="prefetch" href="/storehouse-page/assets/js/35.75390ab1.js"><link rel="prefetch" href="/storehouse-page/assets/js/36.d0c5ae50.js"><link rel="prefetch" href="/storehouse-page/assets/js/37.dd6b45ed.js"><link rel="prefetch" href="/storehouse-page/assets/js/38.b55a1d80.js"><link rel="prefetch" href="/storehouse-page/assets/js/39.3d9d3882.js"><link rel="prefetch" href="/storehouse-page/assets/js/4.e30ce7f4.js"><link rel="prefetch" href="/storehouse-page/assets/js/40.90fe91d1.js"><link rel="prefetch" href="/storehouse-page/assets/js/41.7486baac.js"><link rel="prefetch" href="/storehouse-page/assets/js/42.35b07141.js"><link rel="prefetch" href="/storehouse-page/assets/js/43.e648ad8f.js"><link rel="prefetch" href="/storehouse-page/assets/js/44.dcaf2a1a.js"><link rel="prefetch" href="/storehouse-page/assets/js/45.c124e1b8.js"><link rel="prefetch" href="/storehouse-page/assets/js/46.3aac698c.js"><link rel="prefetch" href="/storehouse-page/assets/js/47.22d1fdc6.js"><link rel="prefetch" href="/storehouse-page/assets/js/48.c0a28343.js"><link rel="prefetch" href="/storehouse-page/assets/js/49.07e1fef7.js"><link rel="prefetch" href="/storehouse-page/assets/js/5.fb35a609.js"><link rel="prefetch" href="/storehouse-page/assets/js/50.17411fee.js"><link rel="prefetch" href="/storehouse-page/assets/js/51.b4061365.js"><link rel="prefetch" href="/storehouse-page/assets/js/52.2c849d22.js"><link rel="prefetch" href="/storehouse-page/assets/js/53.9a1e4174.js"><link rel="prefetch" href="/storehouse-page/assets/js/54.1dab38d9.js"><link rel="prefetch" href="/storehouse-page/assets/js/55.c67f9976.js"><link rel="prefetch" href="/storehouse-page/assets/js/56.b99f35c8.js"><link rel="prefetch" href="/storehouse-page/assets/js/57.6db07bc1.js"><link rel="prefetch" href="/storehouse-page/assets/js/58.57735da4.js"><link rel="prefetch" href="/storehouse-page/assets/js/59.af46e6af.js"><link rel="prefetch" href="/storehouse-page/assets/js/6.1a017389.js"><link rel="prefetch" href="/storehouse-page/assets/js/60.eb81abd1.js"><link rel="prefetch" href="/storehouse-page/assets/js/61.6a32d392.js"><link rel="prefetch" href="/storehouse-page/assets/js/62.f4bac137.js"><link rel="prefetch" href="/storehouse-page/assets/js/63.2da37952.js"><link rel="prefetch" href="/storehouse-page/assets/js/64.70acdaaa.js"><link rel="prefetch" href="/storehouse-page/assets/js/65.199df4fb.js"><link rel="prefetch" href="/storehouse-page/assets/js/66.74573485.js"><link rel="prefetch" href="/storehouse-page/assets/js/67.185c9f42.js"><link rel="prefetch" href="/storehouse-page/assets/js/68.9565a3b6.js"><link rel="prefetch" href="/storehouse-page/assets/js/69.e2548b9a.js"><link rel="prefetch" href="/storehouse-page/assets/js/7.536fb0bb.js"><link rel="prefetch" href="/storehouse-page/assets/js/70.71cdcedd.js"><link rel="prefetch" href="/storehouse-page/assets/js/71.aa7a4c0b.js"><link rel="prefetch" href="/storehouse-page/assets/js/72.bff5b87c.js"><link rel="prefetch" href="/storehouse-page/assets/js/73.47cd1370.js"><link rel="prefetch" href="/storehouse-page/assets/js/74.94d256f5.js"><link rel="prefetch" href="/storehouse-page/assets/js/8.639b5dff.js">
    <link rel="stylesheet" href="/storehouse-page/assets/css/0.styles.50cbef9e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/storehouse-page/" class="home-link router-link-active"><img src="./assets/img/logo.png" alt="store house" class="logo"> <span class="site-name can-hide">store house</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/storehouse-page/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/storehouse-page/algorithm/" class="nav-link">
  Algorithm
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Collect" class="dropdown-title"><span class="title">Collect</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/storehouse-page/nodejs/1.pm2原理.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/浏览器原理/1.进程架构.html" class="nav-link">
  浏览器原理
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/网络/1.http-1.0-1.1-2.html" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/性能优化/" class="nav-link">
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/相关面试题/js/1.new操作符做了什么.html" class="nav-link">
  相关面试题
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/vue/2.0/1.vue-diff.html" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/其他/1.base64 编码.html" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/storehouse-page/resume/" class="nav-link">
  Resume
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/storehouse-page/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/storehouse-page/algorithm/" class="nav-link">
  Algorithm
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Collect" class="dropdown-title"><span class="title">Collect</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/storehouse-page/nodejs/1.pm2原理.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/浏览器原理/1.进程架构.html" class="nav-link">
  浏览器原理
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/网络/1.http-1.0-1.1-2.html" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/性能优化/" class="nav-link">
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/相关面试题/js/1.new操作符做了什么.html" class="nav-link">
  相关面试题
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/vue/2.0/1.vue-diff.html" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/storehouse-page/其他/1.base64 编码.html" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/storehouse-page/resume/" class="nav-link">
  Resume
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/storehouse-page/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/#相关工具" class="sidebar-link">相关工具</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/storehouse-page/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/#主要指标" class="sidebar-link">主要指标</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/storehouse-page/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/#fcp（first-content-paint）首次内容绘制" class="sidebar-link">FCP（First Content Paint）首次内容绘制</a></li><li class="sidebar-sub-header"><a href="/storehouse-page/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/#lcp（largest-contentful-paint）最大内容绘制" class="sidebar-link">LCP（Largest Contentful Paint）最大内容绘制</a></li><li class="sidebar-sub-header"><a href="/storehouse-page/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/#tti（time-to-interactive）首次可交互时间" class="sidebar-link">TTI（Time to Interactive）首次可交互时间</a></li><li class="sidebar-sub-header"><a href="/storehouse-page/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/#fid（first-input-delay）首次输入延迟" class="sidebar-link">FID（First Input Delay）首次输入延迟</a></li></ul></li><li><a href="/storehouse-page/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/#performance" class="sidebar-link">Performance</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/storehouse-page/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/#性能指标计算" class="sidebar-link">性能指标计算</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="性能优化"><a href="#性能优化" class="header-anchor">#</a> 性能优化</h1> <p>要做好性能优化，首先要知道有哪些指标和工具来衡量相关的优化方向</p> <p>主要包括：</p> <ul><li>网络优化</li> <li>首屏优化</li> <li>js/css/图片资源治理</li> <li>js执行耗时治理</li> <li>页面样式重排重绘优化</li> <li>cpu占用处理</li> <li>体验增强</li> <li>容错降级</li></ul> <h2 id="相关工具"><a href="#相关工具" class="header-anchor">#</a> 相关工具</h2> <ul><li>devtool-Audits(lighthouse)：检测页面性能瓶颈，性能报告</li> <li>devtool-Performance-bottom-up：js函数执行耗时</li> <li>devtool-Memory：内存检测</li> <li>devtool-Layers：页面绘制排版性能分析</li> <li>devtool-JavaScript Profiler：cpu占用检测</li> <li>devtool-Network-Performance monitor：实时监控cpu、堆内存、dom数量等指标</li></ul> <h2 id="主要指标"><a href="#主要指标" class="header-anchor">#</a> 主要指标</h2> <blockquote><p>内容呈现相关：FP、FCP、FMP、LCP、SI、FSP、CLS
交互响应相关：TTI、FID、FCI(不推荐)、TBT</p></blockquote> <h3 id="fcp（first-content-paint）首次内容绘制"><a href="#fcp（first-content-paint）首次内容绘制" class="header-anchor">#</a> FCP（First Content Paint）首次内容绘制</h3> <blockquote><p>和 <code>白屏</code> 时间相关的指标。FCP 可以作为网络加载相关优化的参考</p> <p>chrome-devtool =&gt; performance =&gt; timing =&gt; FCP</p></blockquote> <p>记录页面首次绘制文本、图片、非空白 Canvas 或 SVG 的时间。</p> <p>官方推荐的时间区间 :</p> <table><thead><tr><th>FCP 时间（秒）</th> <th>颜色</th> <th>得分（http）</th></tr></thead> <tbody><tr><td>0-2</td> <td>Green(fast)</td> <td>75-100</td></tr> <tr><td>2-4</td> <td>Orange(moderate)</td> <td>50-74</td></tr> <tr><td>4以上</td> <td>Red(low)</td> <td>0-49</td></tr></tbody></table> <h4 id="优化："><a href="#优化：" class="header-anchor">#</a> 优化：</h4> <h5 id="a-网络优化"><a href="#a-网络优化" class="header-anchor">#</a> a.网络优化</h5> <ol><li><p>开启 <code>keep-alive</code>，使用 <code>HTTP2.0</code>，利用多路复用机制，防止队首阻塞</p></li> <li><p><code>dns-prefetch</code> 预解析 DNS 的 IP 地址。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>//hot.onlinemovieweb.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div></li> <li><p>对资源使用 <code>preload</code>，<code>prefetch</code></p> <p>preload 与 prefetch 不同的地方就是它专注于<strong>当前的页面</strong>，并以<strong>高优先级</strong>加载资源，prefetch 专注于下一个页面将要加载的资源并以低优先级加载。同时也要注意 preload 并不会阻塞 window 的 <code>onload</code> 事件。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://example.com/fonts/font.woff<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>prefetch</code> <strong>低优先级</strong>，允许浏览器在后台（空闲时）获取<strong>将来</strong>可能用得到的资源，并且将他们存储在浏览器的缓存中。</p></li></ol> <h5 id="b-浏览器同一域名-6个通道的限制-，减少-http-请求"><a href="#b-浏览器同一域名-6个通道的限制-，减少-http-请求" class="header-anchor">#</a> b.浏览器同一域名 <code>6</code>个通道的限制 ，减少 HTTP 请求</h5> <ol><li><p>js/css 资源合并，合并 <strong>vendor chunk</strong> 和 <strong>page chunk</strong></p></li> <li><p>SVG字体包（iconfont），小图片 <code>base64</code>（图片太多可通过webpack 拆包合并为一个js，解决缓存问题）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        icons<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex">/[\\/]vicon[\\/]/</span><span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token string">'icons'</span><span class="token punctuation">,</span>
          chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
          enforce<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>静态资源部署到<code>CDN</code>（Content Delivery Network，内容分发网络 ），利用CDN 加速和缓存，降低网络的拥塞状况、提高请求的响应速度，也能够减少源站的负载压力，还可以优化浏览器同一域名6个通道的限制</p> <p>原理：将源站的内容发布到离用户较短中间环节的网络节点 ，用户可以就近获取所需数据 。</p></li></ol> <h5 id="c-减少资源体积"><a href="#c-减少资源体积" class="header-anchor">#</a> c.减少资源体积</h5> <ol><li><p>js/css 压缩，去重（js：terser-webpack-plugin，css：optimize-css-assets-webpack-plugin ）</p></li> <li><p>js 使用 <code>Tree-shaking</code> 删除无用代码</p></li> <li><p>图片压缩，尽可能使用 <code>webp</code> 格式，其次是 jpg</p></li> <li><p>服务端 <code>gzip</code> 压缩</p></li> <li><p>拆包优化，通过<code>按需加载</code>减少体积</p></li></ol> <hr> <h3 id="lcp（largest-contentful-paint）最大内容绘制"><a href="#lcp（largest-contentful-paint）最大内容绘制" class="header-anchor">#</a> LCP（Largest Contentful Paint）最大内容绘制</h3> <blockquote><p>更想知道的是页面主要的内容是何时呈现出来的，因为这个指标会持续更新</p> <p>chrome-devtool =&gt; performance =&gt; timing =&gt; LCP</p></blockquote> <p>记录视窗内最大的元素绘制的时间，该时间会随着页面渲染变化而变化，该指标会在用户第一次交互后停止记录。</p> <p>官方推荐的时间区间 :</p> <table><thead><tr><th>LCP 时间（秒）</th> <th>颜色</th></tr></thead> <tbody><tr><td>0-2.5</td> <td>Green(<code>Good</code>)</td></tr> <tr><td>2.5-4</td> <td>Orange(<code>needs improvement</code>)</td></tr> <tr><td>4以上</td> <td>Red(<code>poor</code>)</td></tr></tbody></table> <h4 id="优化：-2"><a href="#优化：-2" class="header-anchor">#</a> 优化：</h4> <ol><li><p>虚拟滚动列表（无限列表）</p></li> <li><p><a href="https://juejin.im/post/59bf501ff265da06602971b9" target="_blank" rel="noopener noreferrer">组件懒加载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>服务端渲染 / 预渲染</p></li></ol> <hr> <h3 id="tti（time-to-interactive）首次可交互时间"><a href="#tti（time-to-interactive）首次可交互时间" class="header-anchor">#</a> TTI（Time to Interactive）首次可交互时间</h3> <blockquote><p>代表着页面何时真正进入可用的状态。光内容渲染的快也不够，还要能迅速响应用户的交互</p></blockquote> <p>需要满足以下几个条件:</p> <ul><li>从 FCP 指标后开始计算</li> <li>持续 5 秒内无长任务（执行时间超过 <strong>50 ms</strong>）且无两个以上正在进行中的 GET 请求</li> <li>往前回溯至 5 秒前的最后一个长任务结束的时间</li></ul> <p>为什么是 <strong>50ms</strong> ?</p> <p>对于用户交互（比如点击事件），推荐的响应时间是 100ms 以内。那么为了达成这个目标，推荐在空闲时间里执行任务不超过 50ms（<a href="https://www.w3.org/TR/2017/WD-longtasks-1-20170907/" target="_blank" rel="noopener noreferrer">W3C<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 也有这样的标准规定），这样能在用户无感知的情况下响应用户的交互，否则就会造成延迟感。</p> <h4 id="优化：-3"><a href="#优化：-3" class="header-anchor">#</a> 优化：</h4> <h5 id="优化耗时任务"><a href="#优化耗时任务" class="header-anchor">#</a> 优化耗时任务</h5> <ol><li><p>将耗时任务等跟dom无关的事情交给 <code>Web Worker</code> 执行</p></li> <li><p>时间切片和 <code>requestIdleCallback</code> 调度，尽量保证任务只在浏览器的空闲时间中执行而不卡顿主线程</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">timeSlicing</span> <span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	gen <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  	<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">deadline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token keyword">while</span><span class="token punctuation">(</span>deadline<span class="token punctuation">.</span><span class="token function">timeRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          		res <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span>
        	<span class="token punctuation">}</span>
        	<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    	<span class="token punctuation">}</span><span class="token punctuation">)</span>
  	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <hr> <h3 id="fid（first-input-delay）首次输入延迟"><a href="#fid（first-input-delay）首次输入延迟" class="header-anchor">#</a> FID（First Input Delay）首次输入延迟</h3> <blockquote><p>看用户交互事件触发到页面响应中间耗时多少，如果其中有长任务发生的话那么势必会造成响应时间变长</p></blockquote> <p>记录在 FCP 和 TTI 之间用户首次与页面交互时响应的延迟。用户交互事件触发到页面响应中间耗时多少，如果其中有长任务发生的话那么势必会造成响应时间变长。</p> <p>官方推荐的时间区间 :</p> <table><thead><tr><th>FID 时间</th> <th>颜色</th></tr></thead> <tbody><tr><td>100ms</td> <td>Green(<code>Good</code>)</td></tr> <tr><td>100ms-300ms</td> <td>Orange(<code>needs improvement</code>)</td></tr> <tr><td>300ms以上</td> <td>Red(<code>poor</code>)</td></tr></tbody></table> <h4 id="优化同上："><a href="#优化同上：" class="header-anchor">#</a> 优化同上：</h4> <hr> <h2 id="performance"><a href="#performance" class="header-anchor">#</a> Performance</h2> <blockquote><p>performance.timing</p></blockquote> <p><img src="/storehouse-page/assets/img/performance.7ee16995.jpg" alt=""></p> <ul><li><code>navigationStart</code>：代表浏览器开始unload前一个页面文档的开始时间节点。比如我们当前正在浏览baidu.com，在地址栏输入google.com并回车，浏览器的执行动作依次为：unload当前文档（即baidu.com）-&gt;请求下一文档（即google.com）。navigationStart的值便是触发unload当前文档的时间节点。配合这一个食用:<a href="/storehouse-page/浏览器原理/2.输入url到页面展示.html">输入url到页面展示</a></li> <li><code>domainLookupStart</code> 和 <code>domainLookupEnd</code> 分别代表DNS查询的开始和结束时间节点。如果浏览器没有进行DNS查询（比如使用了cache），则两者的值都等于fetchStart。</li> <li><code>fetchStart</code> 是指在浏览器发起任何请求之前的时间值。在fetchStart和domainLookupStart之间，浏览器会检查当前文档的缓存。</li> <li><code>connectStart</code> 和 <code>connectEnd</code> 分别代表TCP建立连接和连接成功的时间节点。如果浏览器没有进行TCP连接（比如使用持久化连接webscoket），则两者都等于domainLookupEnd。</li> <li><code>responseStart</code>和 <code>responseEnd</code> 分别代表浏览器收到从服务器端（或缓存、本地资源）响应回的第一个字节和最后一个字节数据的时刻。</li> <li><code>domLoading</code> 代表浏览器开始解析html文档的时间节点。</li> <li><code>domInteractive</code> 代表浏览器解析html文档的状态为interactive时的时间节点。domInteractive并非DOMReady，它早于DOMReady触发，代表html文档解析完毕（即dom tree创建完成）但是内嵌资源（比如外链css、js等）还未加载的时间点。</li></ul> <h3 id="性能指标计算"><a href="#性能指标计算" class="header-anchor">#</a> 性能指标计算</h3> <ul><li>DNS查询耗时 = domainLookupEnd - domainLookupStart</li> <li>TCP链接耗时 = connectEnd - connectStart</li> <li>白屏时间(<code>FP</code>) = responseEnd - fetchStart</li> <li>首次可交互时间(<code>TTI</code>) = domInteractive - fetchStart</li> <li>页面完全加载时间 = loadEventStart -fetchStart</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/storehouse-page/assets/js/app.89c6b4d2.js" defer></script><script src="/storehouse-page/assets/js/2.36872be9.js" defer></script><script src="/storehouse-page/assets/js/9.6aff79fc.js" defer></script>
  </body>
</html>
